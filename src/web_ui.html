<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Windchill XLSX to Knowledge Graph</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen, Ubuntu, Cantarell, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            padding: 20px;
            color: #333;
        }

        .container {
            max-width: 800px;
            margin: 0 auto;
            background: white;
            border-radius: 12px;
            box-shadow: 0 20px 60px rgba(0,0,0,0.3);
            overflow: hidden;
        }

        .header {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            padding: 30px;
            text-align: center;
        }

        .header h1 {
            font-size: 28px;
            font-weight: 600;
            margin-bottom: 8px;
        }

        .header p {
            font-size: 14px;
            opacity: 0.9;
        }

        .content {
            padding: 30px;
        }

        .form-section {
            margin-bottom: 30px;
        }

        .form-section:last-child {
            margin-bottom: 0;
        }

        .section-title {
            font-size: 18px;
            font-weight: 600;
            color: #667eea;
            margin-bottom: 15px;
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .section-title::before {
            content: '';
            width: 4px;
            height: 20px;
            background: #667eea;
            border-radius: 2px;
        }

        .form-group {
            margin-bottom: 20px;
        }

        .form-group label {
            display: flex;
            align-items: center;
            gap: 8px;
            font-weight: 500;
            margin-bottom: 8px;
            font-size: 14px;
            color: #555;
        }

        .tooltip-icon {
            display: inline-flex;
            align-items: center;
            justify-content: center;
            width: 18px;
            height: 18px;
            border-radius: 50%;
            background: #667eea;
            color: white;
            font-size: 12px;
            cursor: help;
            position: relative;
        }

        .tooltip-icon:hover .tooltip-text {
            visibility: visible;
            opacity: 1;
        }

        .tooltip-text {
            visibility: hidden;
            opacity: 0;
            position: absolute;
            z-index: 1000;
            bottom: 125%;
            left: -10px;
            background: #333;
            color: white;
            padding: 10px 12px;
            border-radius: 6px;
            font-size: 12px;
            font-weight: normal;
            width: 250px;
            text-align: left;
            line-height: 1.4;
            transition: opacity 0.3s;
            box-shadow: 0 4px 12px rgba(0,0,0,0.3);
        }

        .tooltip-text::after {
            content: '';
            position: absolute;
            top: 100%;
            left: 20px;
            border: 6px solid transparent;
            border-top-color: #333;
        }

        select, input[type="text"], input[type="number"] {
            width: 100%;
            padding: 10px 12px;
            border: 2px solid #e0e0e0;
            border-radius: 6px;
            font-size: 14px;
            transition: border-color 0.3s;
            font-family: inherit;
        }

        select:focus, input:focus {
            outline: none;
            border-color: #667eea;
        }

        select:disabled, input:disabled {
            background: #f5f5f5;
            cursor: not-allowed;
        }

        .checkbox-group {
            display: flex;
            align-items: center;
            gap: 8px;
            padding: 10px 0;
        }

        .checkbox-group input[type="checkbox"] {
            width: 18px;
            height: 18px;
            cursor: pointer;
        }

        .checkbox-group label {
            margin: 0;
            cursor: pointer;
        }

        .database-selector {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 15px;
        }

        .db-option {
            padding: 15px;
            border: 2px solid #e0e0e0;
            border-radius: 8px;
            cursor: pointer;
            transition: all 0.3s;
            text-align: center;
<<<<<<< Updated upstream
=======
            display: block;
            position: relative;
            user-select: none;
>>>>>>> Stashed changes
        }

        .db-option:hover {
            border-color: #667eea;
            background: #f8f9ff;
        }

        .db-option.selected {
            border-color: #667eea;
            background: #667eea;
            color: white;
        }

        .db-option input[type="checkbox"] {
            display: none;
        }

        .db-option input[type="radio"] {
            display: none;
        }

        .db-option-title {
            font-weight: 600;
            font-size: 16px;
            margin-bottom: 5px;
        }

        .db-option-url {
            font-size: 12px;
            opacity: 0.7;
        }

        .advanced-options {
            background: #f8f9ff;
            border-radius: 8px;
            padding: 20px;
            margin-top: 10px;
        }

        .button-group {
            display: flex;
            gap: 15px;
            margin-top: 30px;
        }

        .btn {
            flex: 1;
            padding: 14px 24px;
            border: none;
            border-radius: 8px;
            font-size: 16px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s;
            font-family: inherit;
        }

        .btn-primary {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
        }

        .btn-primary:hover:not(:disabled) {
            transform: translateY(-2px);
            box-shadow: 0 8px 20px rgba(102, 126, 234, 0.4);
        }

        .btn-secondary {
            background: white;
            color: #667eea;
            border: 2px solid #667eea;
        }

        .btn-secondary:hover:not(:disabled) {
            background: #667eea;
            color: white;
        }

        .btn:disabled {
            opacity: 0.5;
            cursor: not-allowed;
        }

        .status-panel {
            margin-top: 20px;
            padding: 15px;
            border-radius: 8px;
            font-size: 14px;
            display: none;
        }

        .status-panel.info {
            background: #e3f2fd;
            color: #1976d2;
            border-left: 4px solid #1976d2;
        }

        .status-panel.success {
            background: #e8f5e9;
            color: #2e7d32;
            border-left: 4px solid #2e7d32;
        }

        .status-panel.error {
            background: #ffebee;
            color: #c62828;
            border-left: 4px solid #c62828;
        }

        .status-panel.show {
            display: block;
        }

        .loading {
            display: inline-block;
            width: 16px;
            height: 16px;
            border: 2px solid rgba(255,255,255,0.3);
            border-top-color: white;
            border-radius: 50%;
            animation: spin 0.8s linear infinite;
        }

        @keyframes spin {
            to { transform: rotate(360deg); }
        }

        .grid-2 {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 15px;
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>Windchill XLSX to Knowledge Graph</h1>
            <p>Import Bill of Materials data from Excel into graph databases</p>
        </div>

        <div class="content">
            <form id="importForm">
                <!-- Data Source Section -->
                <div class="form-section">
                    <div class="section-title">Data Source</div>

                    <div class="form-group">
                        <label>
                            Excel File
                            <span class="tooltip-icon">
                                ?
                                <span class="tooltip-text">Select the Excel workbook containing part data and BOM relationships. Supported files: Snowmobile.xlsx, Helicopter.xlsx, Mower.xlsx</span>
                            </span>
                        </label>
                        <select id="excelFile" required>
                            <option value="">Loading...</option>
                        </select>
                    </div>

<<<<<<< Updated upstream
                    <div class="checkbox-group">
                        <input type="checkbox" id="reuseBom">
                        <label for="reuseBom">
                            Reuse existing BOM file
                            <span class="tooltip-icon">
                                ?
                                <span class="tooltip-text">Check to reuse an existing BOM CSV file. When unchecked, a new BOM file will be generated from the Excel data. Existing files: bom.csv (number-based) or bom_by_name.csv (name-based).</span>
                            </span>
                        </label>
                    </div>

                    <div class="form-group" id="bomFileGroup" style="display: none;">
                        <label>
                            Select BOM File
                            <span class="tooltip-icon">
                                ?
                                <span class="tooltip-text">Select which BOM CSV file to use. Number-based (bom.csv) is more reliable, name-based (bom_by_name.csv) is more human-friendly.</span>
                            </span>
                        </label>
                        <select id="bomFile">
                            <option value="">Loading...</option>
                        </select>
                    </div>

                    <div class="checkbox-group">
                        <input type="checkbox" id="bomByName">
                        <label for="bomByName">
                            BOM uses names instead of numbers
                            <span class="tooltip-icon">
                                ?
                                <span class="tooltip-text">Enable if your BOM CSV uses part names (e.g., "Parent Name", "Child Name") instead of part numbers. Name resolution will be performed automatically.</span>
                            </span>
                        </label>
                    </div>
=======
                    <!-- BOM will be regenerated automatically from the selected Excel workbook -->
>>>>>>> Stashed changes
                </div>

                <!-- Target Database Section -->
                <div class="form-section">
                    <div class="section-title">Target Database</div>

                    <div class="database-selector">
                        <label class="db-option" id="graphdbOption">
<<<<<<< Updated upstream
                            <input type="checkbox" name="database" value="graphdb" checked>
=======
                            <input type="checkbox" name="database" value="graphdb">
>>>>>>> Stashed changes
                            <div class="db-option-title">GraphDB</div>
                            <div class="db-option-url">localhost:7200</div>
                        </label>
                        <label class="db-option" id="neo4jOption">
                            <input type="checkbox" name="database" value="neo4j">
                            <div class="db-option-title">Neo4j</div>
                            <div class="db-option-url">localhost:7474</div>
                        </label>
                    </div>

                    <!-- GraphDB Repository Selection -->
                    <div class="form-group" id="graphdbRepoGroup" style="margin-top: 20px;">
                        <label>
                            GraphDB Repository
                            <span class="tooltip-icon">
                                ?
                                <span class="tooltip-text">Select the target GraphDB repository where data will be imported. Make sure it exists before importing.</span>
                            </span>
                        </label>
                        <select id="graphdbRepository">
                            <option value="">Loading...</option>
                        </select>
                    </div>

                    <!-- Neo4j Database Selection -->
                    <div class="form-group" id="neo4jRepoGroup" style="margin-top: 20px; display: none;">
                        <label>
                            Neo4j Database
                            <span class="tooltip-icon">
                                ?
                                <span class="tooltip-text">Select the target Neo4j database where data will be imported. Make sure it exists before importing.</span>
                            </span>
                        </label>
                        <select id="neo4jRepository">
                            <option value="">Loading...</option>
                        </select>
                    </div>

<<<<<<< Updated upstream
=======
                    <!-- Neo4j Credentials -->
                    <div id="neo4jCredentialsGroup" style="margin-top: 20px; display: none;">
                        <div class="grid-2">
                            <div class="form-group">
                                <label>Username</label>
                                <input type="text" id="neo4jUsername" value="neo4j">
                            </div>
                            <div class="form-group">
                                <label>Password</label>
                                <input type="password" id="neo4jPassword" value="testpwdpwd">
                            </div>
                        </div>
                    </div>

>>>>>>> Stashed changes
                </div>

                <!-- Advanced Options Section -->
                <div class="form-section">
                    <div class="section-title">Advanced Options</div>

                    <div class="advanced-options">
                        <div class="form-group">
                            <label>
                                Batch Size
                                <span class="tooltip-icon">
                                    ?
                                    <span class="tooltip-text">Number of RDF triples to send in each POST request. Default is 1000. Lower values reduce memory usage but increase network overhead.</span>
                                </span>
                            </label>
                            <input type="number" id="batchSize" value="1000" min="1" max="10000">
                        </div>

<<<<<<< Updated upstream
=======
                        <div class="form-group">
                            <label>
                                Log Level
                                <span class="tooltip-icon">
                                    ?
                                    <span class="tooltip-text">Set the logging verbosity level. INFO shows progress and important messages. DEBUG shows detailed internal information.</span>
                                </span>
                            </label>
                            <select id="logLevel">
                                <option value="DEBUG">DEBUG</option>
                                <option value="INFO" selected>INFO</option>
                                <option value="WARNING">WARNING</option>
                                <option value="ERROR">ERROR</option>
                            </select>
                        </div>

>>>>>>> Stashed changes
                        <div class="checkbox-group">
                            <input type="checkbox" id="strictNames">
                            <label for="strictNames">
                                Strict name resolution
                                <span class="tooltip-icon">
                                    ?
                                    <span class="tooltip-text">Fail immediately if unknown or ambiguous part names are encountered. Recommended for validating data quality. When disabled, unknown/ambiguous names are skipped.</span>
                                </span>
                            </label>
                        </div>

                        <div class="checkbox-group">
                            <input type="checkbox" id="debugNames">
                            <label for="debugNames">
                                Generate debug reports
                                <span class="tooltip-icon">
                                    ?
                                    <span class="tooltip-text">Generate detailed diagnostic files: name_index.csv (all part mappings), bom_name_resolution_report.csv (resolution status), and skipped_names.log (errors).</span>
                                </span>
                            </label>
                        </div>

                        <div class="checkbox-group">
                            <input type="checkbox" id="addEdgeLabels">
                            <label for="addEdgeLabels">
                                Add edge labels
                                <span class="tooltip-icon">
                                    ?
                                    <span class="tooltip-text">Add rdfs:label to relationship edges for better visualization in graph browsers. Slightly increases import time.</span>
                                </span>
                            </label>
                        </div>

                        <div class="checkbox-group">
                            <input type="checkbox" id="dryRun">
                            <label for="dryRun">
                                Dry run (test without importing)
                                <span class="tooltip-icon">
                                    ?
                                    <span class="tooltip-text">Process the data and generate reports without actually importing to the database. Useful for validation and testing.</span>
                                </span>
                            </label>
                        </div>
                    </div>
                </div>

                <!-- Action Buttons -->
                <div class="button-group">
                    <button type="button" class="btn btn-secondary" id="refreshBtn">
                        Refresh Lists
                    </button>
                    <button type="submit" class="btn btn-primary" id="importBtn">
                        Start Import
                    </button>
                </div>

                <!-- Status Panel -->
                <div id="statusPanel" class="status-panel"></div>
<<<<<<< Updated upstream
=======

                <!-- Log Output -->
                <div id="logContainer" style="display: none; margin-top: 20px;">
                    <div class="section-title">Import Logs</div>
                    <pre id="logOutput" style="background: #f5f5f5; padding: 15px; border-radius: 6px; font-family: monospace; font-size: 12px; max-height: 400px; overflow-y: auto; white-space: pre-wrap;"></pre>
                </div>
>>>>>>> Stashed changes
            </form>
        </div>
    </div>

    <script>
        const API_BASE = 'http://localhost:5050';

        // Initialize UI
        document.addEventListener('DOMContentLoaded', () => {
<<<<<<< Updated upstream
=======
            loadSettings();
>>>>>>> Stashed changes
            loadExcelFiles();
            loadBomFiles();
            loadGraphDBRepositories();
            loadNeo4jDatabases();
            setupEventListeners();
        });

        function setupEventListeners() {
<<<<<<< Updated upstream
            // Database selector (checkboxes)
            document.querySelectorAll('.db-option').forEach(option => {
                option.addEventListener('click', (e) => {
                    if (e.target.tagName !== 'INPUT') {
                        const checkbox = option.querySelector('input[type="checkbox"]');
                        checkbox.checked = !checkbox.checked;
                    }

=======
            console.log('Setting up event listeners - v3');

            // Database selector (checkboxes)
            document.querySelectorAll('.db-option').forEach(option => {
                const checkbox = option.querySelector('input[type="checkbox"]');
                console.log('Found db-option:', option.id, 'checkbox:', checkbox);

                // Handle clicks on the label (anywhere in the db-option)
                option.addEventListener('click', (e) => {
                    console.log('Clicked on:', option.id, 'target:', e.target.tagName);

                    // Stop event propagation to prevent double-toggling
                    e.preventDefault();
                    e.stopPropagation();

                    // Toggle the checkbox
                    checkbox.checked = !checkbox.checked;
                    console.log('Toggled checkbox to:', checkbox.checked);

                    // Update UI
>>>>>>> Stashed changes
                    updateDatabaseSelection();
                });
            });

            // Mark initial selection
            updateDatabaseSelection();

<<<<<<< Updated upstream
            // Reuse BOM checkbox handler
            document.getElementById('reuseBom').addEventListener('change', (e) => {
                const bomFileGroup = document.getElementById('bomFileGroup');
                if (e.target.checked) {
                    bomFileGroup.style.display = 'block';
                } else {
                    bomFileGroup.style.display = 'none';
                }
            });
=======
            // BOM is regenerated automatically – no reuse option
>>>>>>> Stashed changes

            // Form submission
            document.getElementById('importForm').addEventListener('submit', handleImport);

            // Refresh button
            document.getElementById('refreshBtn').addEventListener('click', () => {
                loadExcelFiles();
                loadBomFiles();
                loadGraphDBRepositories();
                loadNeo4jDatabases();
            });
        }

        function updateDatabaseSelection() {
            const graphdbChecked = document.getElementById('graphdbOption').querySelector('input').checked;
            const neo4jChecked = document.getElementById('neo4jOption').querySelector('input').checked;

            // Update visual selection
            if (graphdbChecked) {
                document.getElementById('graphdbOption').classList.add('selected');
                document.getElementById('graphdbRepoGroup').style.display = 'block';
            } else {
                document.getElementById('graphdbOption').classList.remove('selected');
                document.getElementById('graphdbRepoGroup').style.display = 'none';
            }

            if (neo4jChecked) {
                document.getElementById('neo4jOption').classList.add('selected');
                document.getElementById('neo4jRepoGroup').style.display = 'block';
<<<<<<< Updated upstream
            } else {
                document.getElementById('neo4jOption').classList.remove('selected');
                document.getElementById('neo4jRepoGroup').style.display = 'none';
=======
                document.getElementById('neo4jCredentialsGroup').style.display = 'block';
            } else {
                document.getElementById('neo4jOption').classList.remove('selected');
                document.getElementById('neo4jRepoGroup').style.display = 'none';
                document.getElementById('neo4jCredentialsGroup').style.display = 'none';
>>>>>>> Stashed changes
            }
        }

        async function loadExcelFiles() {
            try {
                const response = await fetch(`${API_BASE}/api/excel-files`);
                const files = await response.json();

                const select = document.getElementById('excelFile');
                select.innerHTML = '<option value="">-- Select Excel File --</option>';
                files.forEach(file => {
                    const option = document.createElement('option');
                    option.value = file;
                    option.textContent = file;
                    select.appendChild(option);
                });
            } catch (error) {
                showStatus('Error loading Excel files: ' + error.message, 'error');
            }
        }

        async function loadBomFiles() {
            try {
                const response = await fetch(`${API_BASE}/api/bom-files`);
                const files = await response.json();

                const select = document.getElementById('bomFile');
                select.innerHTML = '<option value="">-- None (parts only) --</option>';
                files.forEach(file => {
                    const option = document.createElement('option');
                    option.value = file;
                    option.textContent = file;
                    select.appendChild(option);
                });
            } catch (error) {
                showStatus('Error loading BOM files: ' + error.message, 'error');
            }
        }

        async function loadGraphDBRepositories() {
            try {
                const response = await fetch(`${API_BASE}/api/graphdb-repositories`);

                if (!response.ok) {
                    throw new Error(`HTTP ${response.status}: ${response.statusText}`);
                }

                const repos = await response.json();

                const select = document.getElementById('graphdbRepository');
                select.innerHTML = '<option value="">-- Select GraphDB Repository --</option>';

                if (Array.isArray(repos) && repos.length > 0) {
                    repos.forEach(repo => {
                        const option = document.createElement('option');
                        option.value = repo.id || repo.name;
                        option.textContent = repo.title || repo.name || repo.id;
                        select.appendChild(option);
                    });
                } else {
                    select.innerHTML = '<option value="">No GraphDB repositories found</option>';
                    console.warn('No GraphDB repositories found');
                }
            } catch (error) {
                console.error('GraphDB repositories error:', error);
                const select = document.getElementById('graphdbRepository');
                select.innerHTML = '<option value="">GraphDB not available</option>';
                // Don't show error on page load - user might not be using GraphDB
            }
        }

        async function loadNeo4jDatabases() {
            try {
                const response = await fetch(`${API_BASE}/api/neo4j-databases`);

                if (!response.ok) {
                    throw new Error(`HTTP ${response.status}: ${response.statusText}`);
                }

                const repos = await response.json();

                const select = document.getElementById('neo4jRepository');
                select.innerHTML = '<option value="">-- Select Neo4j Database --</option>';

                if (Array.isArray(repos) && repos.length > 0) {
                    repos.forEach(repo => {
                        const option = document.createElement('option');
                        option.value = repo.id || repo.name;
                        option.textContent = repo.title || repo.name || repo.id;
                        select.appendChild(option);
                    });
<<<<<<< Updated upstream
=======
                    // Preselect 'neo4j' if available
                    if (repos.some(repo => (repo.id || repo.name) === 'neo4j')) {
                        select.value = 'neo4j';
                    }
>>>>>>> Stashed changes
                } else {
                    select.innerHTML = '<option value="">No Neo4j databases found</option>';
                    console.warn('No Neo4j databases found');
                }
            } catch (error) {
                console.error('Neo4j databases error:', error);
                const select = document.getElementById('neo4jRepository');
                select.innerHTML = '<option value="">Neo4j not available</option>';
                // Don't show error on page load - user might not be using Neo4j
            }
        }

        async function handleImport(e) {
            e.preventDefault();

<<<<<<< Updated upstream
            const reuseBom = document.getElementById('reuseBom').checked;
=======
>>>>>>> Stashed changes
            const graphdbChecked = document.getElementById('graphdbOption').querySelector('input').checked;
            const neo4jChecked = document.getElementById('neo4jOption').querySelector('input').checked;

            // Validate at least one database selected
            if (!graphdbChecked && !neo4jChecked) {
                showStatus('Please select at least one target database', 'error');
                return;
            }

            const databases = [];
            if (graphdbChecked) {
                const repo = document.getElementById('graphdbRepository').value;
                if (!repo) {
                    showStatus('Please select a GraphDB repository', 'error');
                    return;
                }
                databases.push({ type: 'graphdb', repository: repo });
            }
            if (neo4jChecked) {
                const repo = document.getElementById('neo4jRepository').value;
                if (!repo) {
                    showStatus('Please select a Neo4j database', 'error');
                    return;
                }
                databases.push({ type: 'neo4j', repository: repo });
            }

            const formData = {
                excelFile: document.getElementById('excelFile').value,
<<<<<<< Updated upstream
                bomFile: reuseBom ? (document.getElementById('bomFile').value || null) : null,
                reuseBom: reuseBom,
                bomByName: document.getElementById('bomByName').checked,
                databases: databases,
                batchSize: parseInt(document.getElementById('batchSize').value),
=======
                bomFile: null,
                reuseBom: false,
                bomByName: true,
                databases: databases,
                batchSize: parseInt(document.getElementById('batchSize').value),
                logLevel: document.getElementById('logLevel').value,
                neo4jUsername: document.getElementById('neo4jUsername').value,
                neo4jPassword: document.getElementById('neo4jPassword').value,
>>>>>>> Stashed changes
                strictNames: document.getElementById('strictNames').checked,
                debugNames: document.getElementById('debugNames').checked,
                addEdgeLabels: document.getElementById('addEdgeLabels').checked,
                dryRun: document.getElementById('dryRun').checked
            };

<<<<<<< Updated upstream
=======
            // Save current settings to localStorage
            saveSettings(formData);

>>>>>>> Stashed changes
            const importBtn = document.getElementById('importBtn');
            const originalText = importBtn.textContent;
            importBtn.disabled = true;
            importBtn.innerHTML = '<span class="loading"></span> Importing...';

            showStatus('Starting import...', 'info');

            try {
                const response = await fetch(`${API_BASE}/api/import`, {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify(formData)
                });

                const result = await response.json();

                if (response.ok) {
<<<<<<< Updated upstream
                    showStatus(result.message || 'Import completed successfully!', 'success');
                } else {
                    showStatus(result.error || 'Import failed', 'error');
                }
=======
                    showStatus(result.message || 'Import completed successfully! <a href="#" onclick="toggleLogs(); return false;">View Logs</a>', 'success');
                } else {
                    showStatus((result.error || 'Import failed') + ' <a href="#" onclick="toggleLogs(); return false;">View Logs</a>', 'error');
                }

                // Display logs
                const logOutput = document.getElementById('logOutput');
                let logText = '';
                if (result.results) {
                    result.results.forEach(r => {
                        if (r.output) logText += r.output + '\n';
                        if (r.error) logText += 'ERROR: ' + r.error + '\n';
                    });
                }
                logOutput.textContent = logText;
                document.getElementById('logContainer').style.display = 'block';
>>>>>>> Stashed changes
            } catch (error) {
                showStatus('Error: ' + error.message, 'error');
            } finally {
                importBtn.disabled = false;
                importBtn.textContent = originalText;
            }
        }

        function showStatus(message, type) {
            const panel = document.getElementById('statusPanel');
            panel.className = `status-panel ${type} show`;
<<<<<<< Updated upstream
            panel.textContent = message;
=======
            panel.innerHTML = message;
        }

        function toggleLogs() {
            const container = document.getElementById('logContainer');
            container.style.display = container.style.display === 'none' ? 'block' : 'none';
        }

        function saveSettings(settings) {
            try {
                localStorage.setItem('windchillImportSettings', JSON.stringify(settings));
            } catch (e) {
                console.warn('Failed to save settings to localStorage:', e);
            }
        }

        function loadSettings() {
            try {
                const saved = localStorage.getItem('windchillImportSettings');
                if (saved) {
                    const settings = JSON.parse(saved);

                    // Restore form values
                    if (settings.excelFile) document.getElementById('excelFile').value = settings.excelFile;
                    // BOM settings removed – always regenerated as name-based
                    if (settings.batchSize) document.getElementById('batchSize').value = settings.batchSize;
                    if (settings.logLevel) document.getElementById('logLevel').value = settings.logLevel;
                    if (settings.neo4jUsername) document.getElementById('neo4jUsername').value = settings.neo4jUsername;
                    if (settings.neo4jPassword) document.getElementById('neo4jPassword').value = settings.neo4jPassword;
                    if (settings.strictNames !== undefined) document.getElementById('strictNames').checked = settings.strictNames;
                    if (settings.debugNames !== undefined) document.getElementById('debugNames').checked = settings.debugNames;
                    if (settings.addEdgeLabels !== undefined) document.getElementById('addEdgeLabels').checked = settings.addEdgeLabels;
                    if (settings.dryRun !== undefined) document.getElementById('dryRun').checked = settings.dryRun;

                    // Restore database selection
                    if (settings.databases && settings.databases.length > 0) {
                        settings.databases.forEach(db => {
                            if (db.type === 'graphdb') {
                                document.getElementById('graphdbOption').querySelector('input').checked = true;
                                if (db.repository) document.getElementById('graphdbRepository').value = db.repository;
                            } else if (db.type === 'neo4j') {
                                document.getElementById('neo4jOption').querySelector('input').checked = true;
                                if (db.repository) document.getElementById('neo4jRepository').value = db.repository;
                            }
                        });
                        updateDatabaseSelection();
                    } else {
                        // Default to Neo4j if no previous selection
                        document.getElementById('neo4jOption').querySelector('input').checked = true;
                        updateDatabaseSelection();
                    }

                    // No reuse option – nothing to toggle
                }
            } catch (e) {
                console.warn('Failed to load settings from localStorage:', e);
            }
>>>>>>> Stashed changes
        }
    </script>
</body>
</html>
